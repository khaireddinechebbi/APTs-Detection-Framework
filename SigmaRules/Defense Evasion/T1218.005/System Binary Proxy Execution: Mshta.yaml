title: MSHTA Suspicious Execution with PowerShell or Persistence (Sysmon)
id: b7e5d3c9-4f6a-4f1b-9d3e-8c2f5a6b7d4e
status: stable
description: Detects suspicious mshta.exe execution via cmd.exe or powershell.exe using inline VBScript with PowerShell, or HTA persistence in Startup folder.
author: Khaireddine
date: 2025/09/11
logsource:
  product: windows
  category: process_creation
  service: sysmon
detection:
  sel_img:
    EventID: 1
    Image|endswith: '\mshta.exe'
    ParentImage|endswith:
      - '\cmd.exe'
      - '\powershell.exe'
  sel_vbscript:
    CommandLine|contains:
      - 'vbscript'
      - 'VBScript'
  sel_execute:
    CommandLine|contains|all:
      - 'Execute'
      - 'Wscript.Shell'
      - 'powershell'
  sel_startup:
    CommandLine|contains|all:
      - '\Microsoft\Windows\Start'
      - '\Programs\Startup'
      - '.hta'
  condition: sel_img and ((sel_vbscript and sel_execute) or sel_startup)
fields:
  - UtcTime
  - Image
  - CommandLine
  - ParentImage
  - ParentCommandLine
  - User
falsepositives:
  - Rare legitimate HTA usage by administrators
level: high
tags:
  - attack.execution
  - attack.t1218
  - attack.t1218.005
